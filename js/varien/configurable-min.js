if(typeof Product=="undefined"){var Product={}}Product.Config=Class.create();Product.Config.prototype={initialize:function(a){this.config=a;this.taxConfig=this.config.taxConfig;if(a.containerId){this.settings=$$("#"+a.containerId+" .super-attribute-select")}else{this.settings=$$(".super-attribute-select")}this.state=new Hash();this.priceTemplate=new Template(this.config.template);this.prices=a.prices;if(a.defaultValues){this.values=a.defaultValues}var h=window.location.href.indexOf("#");if(h!=-1){var g=window.location.href.substr(h+1);var d=g.toQueryParams();if(!this.values){this.values={}}for(var c in d){this.values[c]=d[c]}}if(a.inputsInitialized){this.values={};this.settings.each(function(i){if(i.value){var j=i.id.replace(/[a-z]*/,"");this.values[j]=i.value}}.bind(this))}this.settings.each(function(i){Event.observe(i,"change",this.configure.bind(this))}.bind(this));this.settings.each(function(i){var j=i.id.replace(/[a-z]*/,"");if(j&&this.config.attributes[j]){i.config=this.config.attributes[j];i.attributeId=j;this.state[j]=false}}.bind(this));var f=[];for(var c=this.settings.length-1;c>=0;c--){var b=this.settings[c-1]?this.settings[c-1]:false;var e=this.settings[c+1]?this.settings[c+1]:false;if(c==0){this.fillSelect(this.settings[c])}else{this.settings[c].disabled=true}$(this.settings[c]).childSettings=f.clone();$(this.settings[c]).prevSetting=b;$(this.settings[c]).nextSetting=e;f.push(this.settings[c])}this.configureForValues();document.observe("dom:loaded",this.configureForValues.bind(this))},configureForValues:function(){if(this.values){this.settings.each(function(a){var b=a.attributeId;a.value=(typeof(this.values[b])=="undefined")?"":this.values[b];this.configureElement(a)}.bind(this))}},configure:function(b){var a=Event.element(b);this.configureElement(a)},configureElement:function(a){this.reloadOptionLabels(a);if(a.value){this.state[a.config.id]=a.value;if(a.nextSetting){a.nextSetting.disabled=false;this.fillSelect(a.nextSetting);this.resetChildren(a.nextSetting)}}else{this.resetChildren(a)}this.reloadPrice()},reloadOptionLabels:function(c){var a;if(c.options[c.selectedIndex].config&&!this.config.stablePrices){a=parseFloat(c.options[c.selectedIndex].config.price)}else{a=0}for(var b=0;b<c.options.length;b++){if(c.options[b].config){c.options[b].text=this.getOptionLabel(c.options[b].config,c.options[b].config.price-a)}}},resetChildren:function(b){if(b.childSettings){for(var a=0;a<b.childSettings.length;a++){b.childSettings[a].selectedIndex=0;b.childSettings[a].disabled=true;if(b.config){this.state[b.config.id]=false}}}},fillSelect:function(f){var h=f.id.replace(/[a-z]*/,"");var d=this.getAttributeOptions(h);this.clearSelect(f);f.options[0]=new Option(this.config.chooseText,"");var a=false;if(f.prevSetting){a=f.prevSetting.options[f.prevSetting.selectedIndex]}if(d){var c=1;for(var e=0;e<d.length;e++){var g=[];if(a){for(var b=0;b<d[e].products.length;b++){if(a.config.allowedProducts&&a.config.allowedProducts.indexOf(d[e].products[b])>-1){g.push(d[e].products[b])}}}else{g=d[e].products.clone()}if(g.size()>0){d[e].allowedProducts=g;f.options[c]=new Option(this.getOptionLabel(d[e],d[e].price),d[e].id);if(typeof d[e].price!="undefined"){f.options[c].setAttribute("price",d[e].price)}f.options[c].config=d[e];c++}}}},getOptionLabel:function(c,d){var d=parseFloat(d);if(this.taxConfig.includeTax){var b=d/(100+this.taxConfig.defaultTax)*this.taxConfig.defaultTax;var f=d-b;var a=f*(1+(this.taxConfig.currentTax/100))}else{var b=d*(this.taxConfig.currentTax/100);var f=d;var a=f+b}if(this.taxConfig.showIncludeTax||this.taxConfig.showBothPrices){d=a}else{d=f}var e=c.label;if(d){if(this.taxConfig.showBothPrices){e+=" "+this.formatPrice(f,true)+" ("+this.formatPrice(d,true)+" "+this.taxConfig.inclTaxTitle+")"}else{e+=" "+this.formatPrice(d,true)}}return e},formatPrice:function(b,a){var d="";b=parseFloat(b);if(a){if(b<0){d+="-";b=-b}else{d+="+"}}var c=(Math.round(b*100)/100).toString();if(this.prices&&this.prices[c]){d+=this.prices[c]}else{d+=this.priceTemplate.evaluate({price:b.toFixed(2)})}return d},clearSelect:function(b){for(var a=b.options.length-1;a>=0;a--){b.remove(a)}},getAttributeOptions:function(a){if(this.config.attributes[a]){return this.config.attributes[a].options}},reloadPrice:function(){if(this.config.disablePriceReload){return}var d=0;var a=0;for(var b=this.settings.length-1;b>=0;b--){var c=this.settings[b].options[this.settings[b].selectedIndex];if(c.config){d+=parseFloat(c.config.price);a+=parseFloat(c.config.oldPrice)}}optionsPrice.changePrice("config",{price:d,oldPrice:a});optionsPrice.reload();return d;if($("product-price-"+this.config.productId)){$("product-price-"+this.config.productId).innerHTML=d}this.reloadOldPrice()},reloadOldPrice:function(){if(this.config.disablePriceReload){return}if($("old-price-"+this.config.productId)){var c=parseFloat(this.config.oldPrice);for(var a=this.settings.length-1;a>=0;a--){var b=this.settings[a].options[this.settings[a].selectedIndex];if(b.config){c+=parseFloat(b.config.price)}}if(c<0){c=0}c=this.formatPrice(c);if($("old-price-"+this.config.productId)){$("old-price-"+this.config.productId).innerHTML=c}}}};